"use strict";(()=>{var e={};e.id=7186,e.ids=[7186],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7328:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>y,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>b});var s={};r.r(s),r.d(s,{GET:()=>GET,POST:()=>POST,dynamic:()=>u});var i=r(10884),a=r(16132),n=r(95798);let o=["fuck","shit","damn","bitch","ass","bastard","crap","piss","dick","cock","pussy","cunt","twat","wank","bollocks","arse","bugger","bloody","prick","slut","whore","f*ck","sh*t","b*tch","a$$","fck","fuk","sht","btch"],l=[/https?:\/\//gi,/www\./gi,/@\w+\.\w+/gi,/\d{10,}/g,/\b(viagra|cialis|poker|casino|lottery|prize|winner|claim|bitcoin|crypto)\b/gi,/\b(buy now|click here|limited time|act now|free money|earn money)\b/gi];function containsProfanity(e){let t=e.toLowerCase(),r=[];for(let e of o){let s=RegExp(`\\b${e}\\b`,"i");s.test(t)&&r.push(e)}return{hasProfanity:r.length>0,words:r}}function isSpam(e,t){let r=[];for(let t of((/https?:\/\//gi.test(e)||/www\./gi.test(e))&&r.push("Contains URLs"),/@\w+\.\w+/gi.test(e)&&r.push("Contains email addresses"),/\d{10,}/g.test(e.replace(/\s/g,""))&&r.push("Contains phone numbers"),l))if(t.test(e)){r.push("Contains spam keywords");break}let s=e.toLowerCase().split(/\s+/),i=new Set(s);s.length>10&&i.size/s.length<.3&&r.push("Excessive word repetition");let a=(e.match(/[A-Z]/g)||[]).length,n=(e.match(/[A-Za-z]/g)||[]).length;return n>10&&a/n>.5&&r.push("Excessive capitals (shouting)"),(/\d{5,}/.test(t)||t.length<2)&&r.push("Suspicious username"),{isSpam:r.length>0,reasons:r}}function validateReviewContent(e,t){let r=containsProfanity(t);if(r.hasProfanity)return{valid:!1,error:"Your review contains inappropriate language. Please keep it professional and respectful."};let s=containsProfanity(e);if(s.hasProfanity)return{valid:!1,error:"Username contains inappropriate language. Please use a respectful name."};let i=isSpam(t,e);if(i.isSpam)return{valid:!1,error:`Your review appears to be spam: ${i.reasons[0]}. Please write a genuine review without promotional content.`};let a=t.toLowerCase().split(/\s+/).filter(e=>e.length>2),n=new Set(a);return n.size<3?{valid:!1,error:"Please write a more detailed review with at least a few different words."}:{valid:!0}}let u="force-dynamic",c=process.env.REVIEWS_GIST_ID||"",p=process.env.GITHUB_TOKEN||"",w=[{id:"demo-1",businessName:"Demo Business",businessSlug:"demo-business",userName:"Sarah Johnson",rating:5,message:"Excellent service! Highly recommend to anyone looking for quality work in Waterlooville.",createdAt:new Date(Date.now()-864e5).toISOString()},{id:"demo-2",businessName:"Waterlooville Shops",businessSlug:"waterlooville-shops",userName:"Mike Peters",rating:4,message:"Great shopping facilities. Sainsburys is particularly good, and the retail park has everything you need.",createdAt:new Date(Date.now()-1728e5).toISOString()}],g=new Map;function checkRateLimit(e){let t=Date.now(),r=g.get(e)||[],s=r.filter(e=>t-e<36e5);return!(s.length>=3)&&(s.push(t),g.set(e,s),!0)}async function getReviews(){if(c&&p)try{let e=await fetch(`https://api.github.com/gists/${c}`,{headers:{Authorization:`token ${p}`,Accept:"application/vnd.github.v3+json"}});if(e.ok){let t=await e.json(),r=t.files["reviews.json"]?.content;if(r)return JSON.parse(r)}}catch(e){console.error("Error fetching from Gist:",e)}return w}async function saveReviews(e){if(c&&p)try{let t=await fetch(`https://api.github.com/gists/${c}`,{method:"PATCH",headers:{Authorization:`token ${p}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({files:{"reviews.json":{content:JSON.stringify(e,null,2)}}})});return t.ok}catch(e){console.error("Error saving to Gist:",e)}return w=e,!0}async function GET(e){let{searchParams:t}=new URL(e.url),r=t.get("target");try{let e=await getReviews();return r&&(e=e.filter(e=>e.businessSlug===r)),e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),n.Z.json({reviews:e})}catch(e){return console.error("Error reading reviews:",e),n.Z.json({reviews:[]})}}async function POST(e){try{let t=await e.json(),{businessName:r,businessSlug:s,userName:i,rating:a,message:o}=t;if(!r||!s||!i||!a||!o)return n.Z.json({error:"Missing required fields"},{status:400});let l=`${i.toLowerCase()}-${s}`;if(!checkRateLimit(l))return n.Z.json({error:"Too many reviews submitted. Please wait before submitting another review."},{status:429});if(a<1||a>5)return n.Z.json({error:"Rating must be between 1 and 5"},{status:400});if(o.length<10||o.length>500)return n.Z.json({error:"Message must be between 10 and 500 characters"},{status:400});let u=validateReviewContent(i,o);if(!u.valid)return n.Z.json({error:u.error},{status:400});let c=await getReviews(),p={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,businessName:r,businessSlug:s,userName:i.trim(),rating:a,message:o.trim(),createdAt:new Date().toISOString()};c.push(p);let w=await saveReviews(c);if(!w)return n.Z.json({error:"Failed to save review"},{status:500});return n.Z.json({success:!0,review:p})}catch(e){return console.error("Error saving review:",e),n.Z.json({error:"Failed to save review"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/reviews/route",pathname:"/api/reviews",filename:"route",bundlePath:"app/api/reviews/route"},resolvedPagePath:"/Users/deankeating/waterlooville-directory/app/api/reviews/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:f,headerHooks:m,staticGenerationBailout:b}=d,y="/api/reviews/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798],()=>__webpack_exec__(7328));module.exports=r})();