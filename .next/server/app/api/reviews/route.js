"use strict";(()=>{var e={};e.id=7186,e.ids=[7186],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},11981:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>j,requestAsyncStorage:()=>S,routeModule:()=>y,serverHooks:()=>R,staticGenerationAsyncStorage:()=>k});var s={};r.r(s),r.d(s,{GET:()=>v,POST:()=>b,runtime:()=>c});var n=r(49303),i=r(88716),a=r(60670),o=r(87070);let u=["fuck","shit","damn","bitch","ass","bastard","crap","piss","dick","cock","pussy","cunt","twat","wank","bollocks","arse","bugger","bloody","prick","slut","whore","f*ck","sh*t","b*tch","a$$","fck","fuk","sht","btch"],l=[/https?:\/\//gi,/www\./gi,/@\w+\.\w+/gi,/\d{10,}/g,/\b(viagra|cialis|poker|casino|lottery|prize|winner|claim|bitcoin|crypto)\b/gi,/\b(buy now|click here|limited time|act now|free money|earn money)\b/gi];function p(e){let t=e.toLowerCase(),r=[];for(let e of u)RegExp(`\\b${e}\\b`,"i").test(t)&&r.push(e);return{hasProfanity:r.length>0,words:r}}let c="nodejs",g=process.env.REVIEWS_GIST_ID??"",h=process.env.GITHUB_TOKEN??"",w=[{id:"demo-1",businessName:"Demo Business",businessSlug:"demo-business",userName:"Sarah Johnson",rating:5,message:"Excellent service! Highly recommend to anyone looking for quality work in Waterlooville.",createdAt:new Date(Date.now()-864e5).toISOString()},{id:"demo-2",businessName:"Waterlooville Shops",businessSlug:"waterlooville-shops",userName:"Mike Peters",rating:4,message:"Great shopping facilities. Sainsburys is particularly good, and the retail park has everything you need.",createdAt:new Date(Date.now()-1728e5).toISOString()}],d=new Map;async function m(){if(g&&h)try{let e=await fetch(`https://api.github.com/gists/${g}`,{headers:{Authorization:`token ${h}`,Accept:"application/vnd.github.v3+json"}});if(e.ok){let t=await e.json(),r=t.files["reviews.json"]?.content;if(r)return JSON.parse(r)}}catch(e){}return w}async function f(e){if(g&&h)try{return(await fetch(`https://api.github.com/gists/${g}`,{method:"PATCH",headers:{Authorization:`token ${h}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({files:{"reviews.json":{content:JSON.stringify(e,null,2)}}})})).ok}catch(e){}return w=e,!0}async function v(e){let{searchParams:t}=new URL(e.url),r=t.get("target");try{let e=await m();return r&&(e=e.filter(e=>e.businessSlug===r)),e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),o.NextResponse.json({reviews:e})}catch(e){return console.error("[API_ERROR]",{route:"/api/reviews",error:e instanceof Error?e.message:String(e)}),o.NextResponse.json({reviews:[]})}}async function b(e){try{let{businessName:t,businessSlug:r,userName:s,rating:n,message:i}=await e.json();if(!t||!r||!s||!n||!i)return o.NextResponse.json({error:"Missing required fields"},{status:400});let a=`${s.toLowerCase()}-${r}`;if(!function(e){let t=Date.now(),r=(d.get(e)||[]).filter(e=>t-e<36e5);return!(r.length>=3)&&(r.push(t),d.set(e,r),!0)}(a))return o.NextResponse.json({error:"Too many reviews submitted. Please wait before submitting another review."},{status:429});if(n<1||n>5)return o.NextResponse.json({error:"Rating must be between 1 and 5"},{status:400});if(i.length<10||i.length>500)return o.NextResponse.json({error:"Message must be between 10 and 500 characters"},{status:400});let u=function(e,t){if(p(t).hasProfanity)return{valid:!1,error:"Your review contains inappropriate language. Please keep it professional and respectful."};if(p(e).hasProfanity)return{valid:!1,error:"Username contains inappropriate language. Please use a respectful name."};let r=function(e,t){let r=[];for(let t of((/https?:\/\//gi.test(e)||/www\./gi.test(e))&&r.push("Contains URLs"),/@\w+\.\w+/gi.test(e)&&r.push("Contains email addresses"),/\d{10,}/g.test(e.replace(/\s/g,""))&&r.push("Contains phone numbers"),l))if(t.test(e)){r.push("Contains spam keywords");break}let s=e.toLowerCase().split(/\s+/),n=new Set(s);s.length>10&&n.size/s.length<.3&&r.push("Excessive word repetition");let i=(e.match(/[A-Z]/g)||[]).length,a=(e.match(/[A-Za-z]/g)||[]).length;return a>10&&i/a>.5&&r.push("Excessive capitals (shouting)"),(/\d{5,}/.test(t)||t.length<2)&&r.push("Suspicious username"),{isSpam:r.length>0,reasons:r}}(t,e);return r.isSpam?{valid:!1,error:`Your review appears to be spam: ${r.reasons[0]}. Please write a genuine review without promotional content.`}:new Set(t.toLowerCase().split(/\s+/).filter(e=>e.length>2)).size<3?{valid:!1,error:"Please write a more detailed review with at least a few different words."}:{valid:!0}}(s,i);if(!u.valid)return o.NextResponse.json({error:u.error},{status:400});let c=await m(),g={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,businessName:t,businessSlug:r,userName:s.trim(),rating:n,message:i.trim(),createdAt:new Date().toISOString()};if(c.push(g),!await f(c))return o.NextResponse.json({error:"Failed to save review"},{status:500});return o.NextResponse.json({success:!0,review:g})}catch(e){return console.error("[API_ERROR]",{route:"/api/reviews",error:e instanceof Error?e.message:String(e)}),o.NextResponse.json({error:"Internal Server Error"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/reviews/route",pathname:"/api/reviews",filename:"route",bundlePath:"app/api/reviews/route"},resolvedPagePath:"/Users/deankeating/waterlooville-directory/app/api/reviews/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:S,staticGenerationAsyncStorage:k,serverHooks:R}=y,x="/api/reviews/route";function j(){return(0,a.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:k})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972],()=>r(11981));module.exports=s})();